// Objeto de traducciones (debe estar en el ámbito global)
const translations = {
    es: {
        titulo: "TiendaLatina | Servicios Latinos en Porto",
        bienvenida: "Conectamos talento Latino en Porto",
        lema: "Encuentra u ofrece servicios con confianza.",
        servicios: "Servicios Populares",
        contacto: "Contáctanos vía:",
        derechos: "© 2025 TiendaLatina. Todos los derechos reservados.",
        menuInicio: "Inicio",
        menuServicios: "Servicios",
        menuContacto: "Contacto",
        whatsapp: "WhatsApp",
        abrirChat: "Abrir Chat",
        instagram: "Instagram",
        seguir: "Seguir",
        serviciosPopulares: "Servicios Populares",
        salud: "Salud",
        transporte: "Transporte",
        explorarServicios: "Explorar Servicios",
        "footer.legal": "Página destinada única y exclusivamente a la promoción de emprendimientos. No cobramos comisión por trabajos realizados.",
        categorias: {
            Belleza: [
                "Cortes modernos",
                "Uñas artísticas",
                "Barbería premium",
                "Maquillaje de novias",
                "Depilación láser",
                "Extensiones profesionales",
                "Tratamientos capilares",
                "Colorimetría avanzada"
            ],
            Hogar: [
                "Limpieza ecológica",
                "Diseño de jardines",
                "Instalaciones eléctricas",
                "Fontanería urgente",
                "Montaje de muebles",
                "Cuidado de ancianos",
                "Pintura decorativa",
                "Impermeabilización"
            ],
            Educacion: [
                "Clases de portugués",
                "Inglés empresarial",
                "Matemáticas avanzadas",
                "Asesoría universitaria",
                "Clases de música",
                "Talleres de cocina",
                "Refuerzo escolar",
                "Preparación de CV"
            ],
            Salud: [
                "Fisioterapia deportiva",
                "Nutrición personalizada",
                "Entrenamiento funcional",
                "Terapia psicológica",
                "Masajes terapéuticos",
                "Acupuntura tradicional",
                "Yoga terapéutico",
                "Reiki energético"
            ],
            Transporte: [
                "Traslados ejecutivos",
                "Servicio de aeropuerto",
                "Mensajería urgente",
                "Alquiler de furgonetas",
                "Transporte médico",
                "Taxi turístico",
                "Eventos corporativos",
                "Guías certificados"
            ],
            Otros: [
                "Fotografía profesional",
                "Diseño gráfico digital",
                "Reparación de smartphones",
                "Asesoría legal migratoria",
                "Traducciones juradas",
                "Organización de eventos",
                "Soluciones IT",
                "Artesanía auténtica"
            ]
        }
    },
    en: {
        titulo: "TiendaLatina | Latin Services in Porto",
        bienvenida: "We connect Latin talent in Porto",
        lema: "Find or offer services with confidence.",
        servicios: "Popular Services",
        contacto: "Contact us via:",
        derechos: "© 2025 TiendaLatina. All rights reserved.",
        menuInicio: "Home",
        menuServicios: "Services",
        menuContacto: "Contact",
        whatsapp: "WhatsApp",
        abrirChat: "Open Chat",
        instagram: "Instagram",
        seguir: "Follow",
        serviciosPopulares: "Popular Services", 
        salud: "Health",
        transporte: "Transportation",
        explorarServicios: "Explore Services",
        "footer.legal": "This page is solely and exclusively intended for the promotion of entrepreneurship. We do not charge commission for completed jobs.",
        categorias: {
            Belleza: [
                "Modern haircuts",
                "Artistic nails",
                "Premium barbering",
                "Bridal makeup",
                "Laser hair removal",
                "Professional extensions",
                "Hair treatments",
                "Advanced colorimetry"
            ],
            Hogar: [
                "Eco cleaning",
                "Garden design",
                "Electrical installations",
                "Emergency plumbing",
                "Furniture assembly",
                "Elderly care",
                "Decorative painting",
                "Waterproofing"
            ],
            Educacion: [
                "Portuguese classes",
                "Business English",
                "Advanced mathematics",
                "University counseling",
                "Music lessons",
                "Cooking workshops",
                "School support",
                "CV preparation"
            ],
            Salud: [
                "Sports physiotherapy",
                "Personalized nutrition",
                "Functional training",
                "Psychological therapy",
                "Therapeutic massages",
                "Traditional acupuncture",
                "Therapeutic yoga",
                "Energy reiki"
            ],
            Transporte: [
                "Executive transfers",
                "Airport service",
                "Express courier",
                "Van rentals",
                "Medical transport",
                "Tourist taxi",
                "Corporate events",
                "Certified guides"
            ],
            Otros: [
                "Professional photography",
                "Digital graphic design",
                "Smartphone repairs",
                "Immigration legal advice",
                "Sworn translations",
                "Event planning",
                "IT solutions",
                "Authentic crafts"
            ]
        }
    },
    pt: {
        titulo: "TiendaLatina | Serviços Latinos no Porto",
        bienvenida: "Conectamos talento Latino no Porto",
        lema: "Encontre ou ofereça serviços com confiança.",
        servicios: "Serviços Populares",
        contacto: "Contacte-nos através de:",
        derechos: "© 2025 TiendaLatina. Todos os direitos reservados.",
        menuInicio: "Início",
        menuServicios: "Serviços",
        menuContacto: "Contacto",
        whatsapp: "WhatsApp",
        abrirChat: "Abrir Chat",
        instagram: "Instagram",
        seguir: "Seguir",
        serviciosPopulares: "Serviços Populares",
        salud: "Saúde",
        transporte: "Transporte",
        explorarServicios: "Explorar Servicios",
        "footer.legal": "Página destinada única e exclusivamente à promoção de empreendimentos. Não cobramos comissão por trabalhos realizados.",
        categorias: {
            Belleza: [
                "Cortes modernos",
                "Unhas artísticas",
                "Barbearia premium",
                "Maquilhagem de noivas",
                "Depilação a laser",
                "Extensões profissionais",
                "Tratamentos capilares",
                "Colorimetria avançada"
            ],
            Hogar: [
                "Limpeza ecológica",
                "Design de jardins",
                "Instalações elétricas",
                "Encanamento urgente",
                "Montagem de móveis",
                "Cuidados a idosos",
                "Pintura decorativa",
                "Impermeabilização"
            ],
            Educacion: [
                "Aulas de português",
                "Inglês empresarial",
                "Matemática avançada",
                "Aconselhamento universitário",
                "Aulas de música",
                "Oficinas de culinária",
                "Reforço escolar",
                "Preparação de CV"
            ],
            Salud: [
                "Fisioterapia esportiva",
                "Nutrição personalizada",
                "Treino funcional",
                "Terapia psicológica",
                "Massagens terapêuticas",
                "Acupuntura tradicional",
                "Yoga terapêutico",
                "Reiki energético"
            ],
            Transporte: [
                "Transferências executivas",
                "Serviço aeroportuário",
                "Mensageiro expresso",
                "Aluguel de furgões",
                "Transporte médico",
                "Táxi turístico",
                "Eventos corporativos",
                "Guias certificados"
            ],
            Otros: [
                "Fotografia profissional",
                "Design gráfico digital",
                "Reparação de smartphones",
                "Aconselhamento legal migratório",
                "Traduções juramentadas",
                "Organização de eventos",
                "Soluções de TI",
                "Artesanato autêntico"
            ]
        }
    }
};

// Función para cambiar idioma (debe ser global)
function changeLanguage(lang) {
    // Traducciones básicas
    document.title = translations[lang].titulo;
    document.querySelector('.footer p').textContent = translations[lang].derechos;

    // Traducción del menú
    const navItems = document.querySelectorAll('.nav-list li a');
    if (navItems.length >= 3) {
        navItems[0].textContent = translations[lang].menuInicio;
        navItems[1].textContent = translations[lang].menuServicios;
        navItems[2].textContent = translations[lang].menuContacto;
    }

    // Botones de contacto
    const qrOptions = document.querySelectorAll('.qr-option p');
    if (qrOptions.length >= 2) {
        qrOptions[0].innerHTML = `<i class="fab fa-whatsapp"></i> ${translations[lang].whatsapp}`;
        qrOptions[1].innerHTML = `<i class="fab fa-instagram"></i> ${translations[lang].instagram}`;
    }

    // Botones de acción
    const qrButtons = document.querySelectorAll('.qr-button');
    if (qrButtons.length >= 2) {
        qrButtons[0].textContent = translations[lang].abrirChat;
        qrButtons[1].textContent = translations[lang].seguir;
    }

    // Título de servicios
    const serviciosTitle = document.querySelector('.services h2');
    if (serviciosTitle) {
        serviciosTitle.textContent = translations[lang].serviciosPopulares;
    }

    // Categorías
    document.querySelectorAll('.categoria-btn').forEach((btn, index) => {
        const categories = [
            translations[lang].categoriaBelleza,
            translations[lang].categoriaHogar,
            translations[lang].categoriaEducacion,
            translations[lang].salud,
            translations[lang].transporte,
            translations[lang].categoriaOtros
        ];
        btn.textContent = categories[index] || btn.textContent;
    });

    // Traducción de servicios 
    document.querySelectorAll('[data-translate]').forEach(element => {
        const [categoria, index] = element.getAttribute('data-translate').split('.');
        if(translations[lang].categorias[categoria][index]) {
            element.textContent = translations[lang].categorias[categoria][index];
        }
    });

    localStorage.setItem('language', lang);
}

// Función para cerrar submenús
function closeSubmenus() {
    const serviciosMenu = document.querySelector('.servicios-container');
    const contactoMenu = document.getElementById('contacto-menu');
    
    serviciosMenu?.classList.remove('active');
    serviciosMenu && (serviciosMenu.style.display = 'none');
    contactoMenu?.classList.remove('active');
    contactoMenu && (contactoMenu.style.display = 'none');
}

// Función para cerrar todos los menús
function closeAllMenus() {
    const navbar = document.querySelector('.navbar');
    const body = document.body;
    
    // Cerrar hamburguesa
    navbar?.classList.remove('active');
    body.classList.remove('menu-open');
    toggleIcon(false);
    // Cerrar submenús
    closeSubmenus();
}

// Función para alternar icono del menú hamburguesa
function toggleIcon(isOpen) {
    const menuToggle = document.querySelector('.menu-toggle');
    const icon = menuToggle?.querySelector('i');
    if (icon) {
        icon.classList.replace(isOpen ? 'fa-bars' : 'fa-times', isOpen ? 'fa-times' : 'fa-bars');
    }
}

// Inicialización cuando el DOM está listo
document.addEventListener('DOMContentLoaded', function() {
    // Inicialización de AOS
    if (typeof AOS !== 'undefined') {
        AOS.init({
            duration: 800,
            offset: 100,
            easing: 'ease-in-out',
            once: true
        });
    }

    // Idioma
    const savedLang = localStorage.getItem('language') || 'es';
    changeLanguage(savedLang);
    
    // Eventos de clic para menús
    document.querySelectorAll('.nav-list a, .language-buttons button').forEach(element => {
        element.addEventListener('click', () => {
            if (window.innerWidth <= 768) {
                document.querySelector('.navbar').classList.remove('active');
            }
        });
    });

    // Menú de contacto
    const contactoLink = document.getElementById("contacto-link");
    const contactoMenu = document.getElementById("contacto-menu");
    const contactoModal = document.getElementById("contacto-modal");
    const closeBtn = document.getElementById("contacto-modal-close");

    if (contactoLink && contactoMenu) {
        contactoLink.addEventListener("click", function (e) {
            e.preventDefault();
            contactoMenu.classList.toggle("visible");
        });

        document.addEventListener("click", function (e) {
            if (!contactoLink.contains(e.target) && !contactoMenu.contains(e.target)) {
                contactoMenu.classList.remove("visible");
            }
        });
    }

    // Modal de contacto en móvil
    if (contactoLink && contactoModal && closeBtn) {
        contactoLink.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                e.preventDefault();
                contactoModal.classList.add('open');
            }
        });

        closeBtn.addEventListener('click', () => contactoModal.classList.remove('open'));
        contactoModal.querySelector('.contacto-modal__backdrop')?.addEventListener('click', () => {
            contactoModal.classList.remove('open');
        });
    }

    // Menú principal y navegación
    const body = document.body;
    const menuToggle = document.querySelector('.menu-toggle');
    const navbar = document.querySelector('.navbar');
    const serviciosLink = document.getElementById('servicios-link');
    const serviciosMenu = document.querySelector('.servicios-container');
    const categoriaBtns = document.querySelectorAll('.categoria-btn');
    const serviciosCategorias = document.querySelectorAll('.servicios-categoria');

    // Crear overlay si no existe
    if (!document.querySelector('.navbar-overlay')) {
        const overlay = document.createElement('div');
        overlay.className = 'navbar-overlay';
        document.body.appendChild(overlay);
        overlay.addEventListener('click', closeAllMenus);
    }

    // Menú Hamburguesa
    if (menuToggle && navbar) {
        menuToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            const wasActive = navbar.classList.contains('active');
            
            // Cerrar todo primero
            closeAllMenus();
            
            // Abrir solo si no estaba activo previamente
            if (!wasActive) {
                navbar.classList.add('active');
                body.classList.add('menu-open');
                toggleIcon(true);
                
                // Resetear submenús
                if (contactoMenu) {
                    contactoMenu.classList.remove('active');
                    contactoMenu.style.display = 'none';
                }
                if (serviciosMenu) {
                    serviciosMenu.style.display = 'none';
                }
            }
        });
    }

    // Mostrar/Ocultar Servicios en móviles
    if (serviciosLink && serviciosMenu) {
        serviciosLink.addEventListener('click', function(e) {
            if (window.innerWidth <= 768) {
                closeAllMenus();
            }
        });
    }

    // Cerrar si clic fuera
    document.addEventListener('click', function (e) {
        if (window.innerWidth <= 768) {
            const clickedInside = e.target.closest('.navbar, .menu-contacto, .menu-servicios');
            if (!clickedInside) closeAllMenus();
        }
    });

    // Categorías de Servicios
    if (categoriaBtns.length > 0) {
        categoriaBtns.forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.preventDefault();
                const categoria = this.getAttribute('data-categoria');

                categoriaBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                serviciosCategorias.forEach(cat => {
                    const matches = cat.getAttribute('data-categoria') === categoria;
                    cat.classList.toggle('active', matches);
                    cat.style.display = matches
                        ? (window.innerWidth <= 768 ? 'block' : 'flex')
                        : 'none';
                });
            });
        });

        // Activar la primera categoría al cargar
        categoriaBtns[0].click();
    }

    // Responder al resize
    window.addEventListener('resize', function () {
        const isMobile = window.innerWidth <= 768;

        if (!isMobile && serviciosMenu) {
            serviciosMenu.classList.add('active');
            serviciosMenu.style.display = 'flex';
        }

        if (isMobile) {
            serviciosMenu?.classList.remove('active');
            contactoMenu?.classList.remove('active');
        }

        serviciosCategorias.forEach(cat => {
            cat.style.display = cat.classList.contains('active')
                ? (isMobile ? 'block' : 'flex')
                : 'none';
        });
    });

    // Inicialización
    if (window.innerWidth > 768 && serviciosMenu) {
        serviciosMenu.classList.add('active');
        serviciosMenu.style.display = 'flex';
    }

    if (contactoMenu) contactoMenu.classList.remove('active');
});